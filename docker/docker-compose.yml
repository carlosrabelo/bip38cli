version: '3.8'

services:
  bip38cli:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        VERSION: ${VERSION:-latest}
        BUILD_TIME: ${BUILD_TIME:-$(date -u +%Y-%m-%dT%H:%M:%SZ)}
    image: bip38cli:latest
    container_name: bip38cli
    restart: unless-stopped
    environment:
      - BIP38CLI_CONFIG=/app/config/.bip38cli.yaml
    volumes:
      - ../config:/app/config:ro
      - ../data:/app/data
    working_dir: /app
    command: ["--help"]

  bip38cli-test:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    image: bip38cli:latest
    container_name: bip38cli-test
    profiles:
      - test
    environment:
      - CGO_ENABLED=0
    volumes:
      - ../core:/app/core:ro
    working_dir: /app/core
    command: ["go", "test", "./...", "-v", "-cover"]

  bip38cli-dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile.dev
    image: bip38cli:dev
    container_name: bip38cli-dev
    profiles:
      - dev
    environment:
      - BIP38CLI_CONFIG=/app/config/.bip38cli.yaml
    volumes:
      - ../core:/app/core
      - ../config:/app/config
    working_dir: /app/core
    command: ["go", "run", "./cmd/bip38cli", "--help"]
